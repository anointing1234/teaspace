{% extends "base_sections/base/base.html" %} 
{% load static %}
{% block contents %}

<style>
/* Apply consistent styling to all input fields */
.contact-form__input-box input[type="text"],
.contact-form__input-box input[type="email"],
.contact-form__input-box input[type="password"],
.contact-form__input-box input[type="number"],
.contact-form__input-box input[type="tel"],
.contact-form__input-box input[type="url"],
.contact-form__input-box textarea {
  height: 60px;
  width: 100%;
  border: none;
  background-color: var(--jetly-primary);
  padding: 0 30px;
  outline: none;
  font-size: 14px;
  color: var(--jetly-gray);
  display: block;
  font-weight: 400;
  border-radius: 6px;
  transition: all 0.3s ease;
}
</style>

<!--Page Header Start-->
<section class="page-header">
    <div class="page-header-bg" style="background-image: url({% static 'assets/images/backgrounds/page-header-bg.jpg' %})"></div>
    <div class="container">
        <div class="page-header__inner">
            <h2>Send Password Reset Code</h2>
            <ul class="thm-breadcrumb list-unstyled">
                <li><a href="{% url 'home' %}">Home</a></li>
                <li><span>/</span></li>
                <li>Send Password Reset Code</li>
            </ul>
        </div>
    </div>
</section>
<!--Page Header End-->

<section class="password-reset mt-5 mb-5">
  <div class="container d-flex justify-content-center">
    <div class="password-reset__form-box" style="max-width: 500px;">
      <form id="password-reset-form" method="POST" novalidate>
        {% csrf_token %}
        <div class="contact-form__input-box">
          <input type="text" name="recovery_code" placeholder="Enter your recovery code" required>
        </div>
        <div class="contact-form__input-box mt-3">
          <input type="password" name="new_password" placeholder="Enter new password" required>
        </div>
        <div class="contact-form__btn-box mt-3 text-center">
          <button type="submit" class="thm-btn">Update Password</button>
        </div>
      </form>
    </div>
  </div>
</section>

<!-- SweetAlert2 -->
<script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>

<script>
document.getElementById("password-reset-form").addEventListener("submit", async function(e) {
  e.preventDefault();
  const form = e.target;
  const button = form.querySelector("button[type='submit']");
  button.disabled = true;
  Swal.fire({ title: "Updating...", text: "Please wait...", icon: "info", showConfirmButton: false, didOpen: () => Swal.showLoading(), width: "300px" });

  try {
    const response = await fetch("{% url 'reset_password' %}", {
      method: "POST",
      headers: { "X-CSRFToken": form.querySelector("[name=csrfmiddlewaretoken]").value },
      body: new FormData(form),
    });

    const data = await response.json();
    if (response.ok && data.success) {
      Swal.fire({ title: "Success!", text: data.message, icon: "success", confirmButtonColor: "#004aad", width: "300px" });
      form.reset();
    } else {
      Swal.fire({ title: "Error", text: data.message, icon: "error", width: "300px" });
      console.error("Server error:", data);
    }
  } catch (error) {
    Swal.fire({ title: "Network Error", text: "Please check your connection.", icon: "error", width: "300px" });
    console.error("Network error:", error);
  } finally {
    button.disabled = false;
  }
});
</script>

{% endblock contents %}
